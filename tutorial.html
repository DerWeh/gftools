<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tutorial &mdash; GfTool 0+untagged.5.ga123c3d documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/plot_directive.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/toggleprompt.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="gftool" href="gftool.html" />
    <link rel="prev" title="Getting started" href="getting-started.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> GfTool
          </a>
              <div class="version">
                0+untagged.5.ga123c3d
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#lattice-green-s-functions">Lattice Green’s functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#density">Density</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fourier-transform">Fourier transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="#single-site-approximation-of-disorder">Single site approximation of disorder</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#coherent-potential-approximation-cpa">Coherent potential approximation (CPA)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#blackman-esterling-berk-beb">Blackman, Esterling, Berk (BEB)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#matrix-green-s-functions-via-diagonalization">Matrix Green’s functions via diagonalization</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="gftool.html">gftool</a></li>
<li class="toctree-l1"><a class="reference internal" href="generated/gftool.beb.html">gftool.beb</a></li>
<li class="toctree-l1"><a class="reference internal" href="generated/gftool.cpa.html">gftool.cpa</a></li>
<li class="toctree-l1"><a class="reference internal" href="generated/gftool.fourier.html">gftool.fourier</a></li>
<li class="toctree-l1"><a class="reference internal" href="generated/gftool.lattice.html">gftool.lattice</a></li>
<li class="toctree-l1"><a class="reference internal" href="generated/gftool.matrix.html">gftool.matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="generated/gftool.pade.html">gftool.pade</a></li>
<li class="toctree-l1"><a class="reference internal" href="generated/gftool.siam.html">gftool.siam</a></li>
</ul>
<p class="caption"><span class="caption-text">Help</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="whats-new.html">What’s New</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GfTool</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Tutorial</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/tutorial.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>This tutorial explains some of the basic functionality.
Throughout the tutorial we assume you have imported <em class="xref py py-obj">GfTool</em> as</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">gftool</span> <span class="k">as</span> <span class="nn">gt</span>
</pre></div>
</div>
<p>and the packages <a class="reference external" href="https://numpy.org/doc/stable/reference/index.html#module-numpy" title="(in NumPy v1.21)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy</span></code></a> and <a class="reference external" href="https://matplotlib.org/index.html#module-matplotlib" title="(in Matplotlib v3.4.3)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">matplotlib</span></code></a> are imported as usual</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<div class="section" id="lattice-green-s-functions">
<h2>Lattice Green’s functions<a class="headerlink" href="#lattice-green-s-functions" title="Permalink to this headline">¶</a></h2>
<p>The package contains non-interacting Green’s functions for some tight-binding
lattices. They can be found in <a class="reference internal" href="generated/gftool.lattice.html#module-gftool.lattice" title="gftool.lattice"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gftool.lattice</span></code></a>.
E.g. the <a class="reference internal" href="generated/gftool.lattice.bethe.dos.html#gftool.lattice.bethe.dos" title="gftool.lattice.bethe.dos"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dos</span></code></a> of the Bethe lattice, <a class="reference internal" href="generated/gftool.lattice.bethe.html#module-gftool.lattice.bethe" title="gftool.lattice.bethe"><code class="xref py py-obj docutils literal notranslate"><span class="pre">bethe</span></code></a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ww</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dos_ww</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">bethe</span><span class="o">.</span><span class="n">dos</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="n">half_bandwidth</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="n">dos_ww</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\epsilon$&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//tutorial-1.png">png</a>, <a class="reference external" href=".//tutorial-1.pdf">pdf</a>)</p>
<div class="figure align-default">
<img alt="_images/tutorial-1.png" class="plot-directive" src="_images/tutorial-1.png" />
</div>
<p>Typically, a shorthand for these functions exist in the top-level module e.g.
<a class="reference internal" href="generated/gftool.bethe_dos.html#gftool.bethe_dos" title="gftool.bethe_dos"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gftool.bethe_dos</span></code></a></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gt</span><span class="o">.</span><span class="n">bethe_dos</span> <span class="ow">is</span> <span class="n">gt</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">bethe</span><span class="o">.</span><span class="n">dos</span>
<span class="go">True</span>
</pre></div>
</div>
<p>The corresponding Green’s functions are also available.
The Green’s functions can be evaluate for any complex frequency,
excluding the real axis, where it might become singular.
E.g. the <a class="reference internal" href="generated/gftool.lattice.fcc.gf_z.html#gftool.lattice.fcc.gf_z" title="gftool.lattice.fcc.gf_z"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gf_z</span></code></a> of the face-centered cubic (fcc) lattice,
<a class="reference internal" href="generated/gftool.lattice.fcc.html#module-gftool.lattice.fcc" title="gftool.lattice.fcc"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fcc</span></code></a>, on a contour parallel to the real axis:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ww</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-6j</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gf_ww</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">fcc</span><span class="o">.</span><span class="n">gf_z</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="n">half_bandwidth</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;dimgray&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;dimgray&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ww</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">gf_ww</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ww</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">gf_ww</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\omega$&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">7.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//tutorial-2.png">png</a>, <a class="reference external" href=".//tutorial-2.pdf">pdf</a>)</p>
<div class="figure align-default">
<img alt="_images/tutorial-2.png" class="plot-directive" src="_images/tutorial-2.png" />
</div>
<p>or on the Matsubara axis:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">beta</span> <span class="o">=</span> <span class="mi">50</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">iws</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">matsubara_frequencies</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">128</span><span class="p">),</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gf_iw</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">lattice</span><span class="o">.</span><span class="n">fcc</span><span class="o">.</span><span class="n">gf_z</span><span class="p">(</span><span class="n">iws</span><span class="p">,</span> <span class="n">half_bandwidth</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;dimgray&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gf_iw</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="s2">&quot;x--&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">gf_iw</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="s2">&quot;+--&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$n$&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//tutorial-3.png">png</a>, <a class="reference external" href=".//tutorial-3.pdf">pdf</a>)</p>
<div class="figure align-default">
<img alt="_images/tutorial-3.png" class="plot-directive" src="_images/tutorial-3.png" />
</div>
</div>
<div class="section" id="density">
<h2>Density<a class="headerlink" href="#density" title="Permalink to this headline">¶</a></h2>
<p>We can also calculate the density (occupation number) from the imaginary axis
for local Green’s function. We have the relation</p>
<div class="math notranslate nohighlight">
\[⟨n⟩ = T \sum_{\{iω_n\}} \Re G(iω_n)\]</div>
<p>To calculate the density for a given temperature from <em class="xref py py-obj">1024</em> (fermionic)
Matsubara frequencies we use <a class="reference internal" href="generated/gftool.density_iw.html#gftool.density_iw" title="gftool.density_iw"><code class="xref py py-obj docutils literal notranslate"><span class="pre">density_iw</span></code></a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">temperature</span> <span class="o">=</span> <span class="mf">0.02</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">iws</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">matsubara_frequencies</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1024</span><span class="p">),</span> <span class="n">beta</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">temperature</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gf_iw</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">bethe_gf_z</span><span class="p">(</span><span class="n">iws</span><span class="p">,</span> <span class="n">half_bandwidth</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">occ</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">density_iw</span><span class="p">(</span><span class="n">iws</span><span class="p">,</span> <span class="n">gf_iw</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">temperature</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">occ</span>
<span class="go">0.5</span>
</pre></div>
</div>
<p>We can also search the chemical potential <span class="math notranslate nohighlight">\(μ\)</span> for a given occupation
using <a class="reference internal" href="generated/gftool.chemical_potential.html#gftool.chemical_potential" title="gftool.chemical_potential"><code class="xref py py-obj docutils literal notranslate"><span class="pre">chemical_potential</span></code></a>.
To get, e.g., the Bethe lattice at quarter filling, we write:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">occ_quarter</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">bethe_occ_diff</span><span class="p">(</span><span class="n">mu</span><span class="p">):</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot;Calculate the difference to the desired occupation, note the sign.&quot;&quot;&quot;</span>
<span class="gp">... </span>    <span class="n">gf_iw</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">bethe_gf_z</span><span class="p">(</span><span class="n">iws</span> <span class="o">+</span> <span class="n">mu</span><span class="p">,</span> <span class="n">half_bandwidth</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">gt</span><span class="o">.</span><span class="n">density_iw</span><span class="p">(</span><span class="n">iws</span><span class="p">,</span> <span class="n">gf_iw</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">temperature</span><span class="p">)</span> <span class="o">-</span> <span class="n">occ_quarter</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mu</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">chemical_potential</span><span class="p">(</span><span class="n">bethe_occ_diff</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mu</span>
<span class="go">-0.406018...</span>
</pre></div>
</div>
<p>Validate the result:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gf_quarter_iw</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">bethe_gf_z</span><span class="p">(</span><span class="n">iws</span> <span class="o">+</span> <span class="n">mu</span><span class="p">,</span> <span class="n">half_bandwidth</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gt</span><span class="o">.</span><span class="n">density_iw</span><span class="p">(</span><span class="n">iws</span><span class="p">,</span> <span class="n">gf_quarter_iw</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">temperature</span><span class="p">)</span>
<span class="go">0.249999...</span>
</pre></div>
</div>
</div>
<div class="section" id="fourier-transform">
<h2>Fourier transform<a class="headerlink" href="#fourier-transform" title="Permalink to this headline">¶</a></h2>
<p><em class="xref py py-obj">GfTool</em> offers also accurate Fourier transformations between Matsubara frequencies
and imaginary time for local Green’s functions, see <a class="reference internal" href="generated/gftool.fourier.html#module-gftool.fourier" title="gftool.fourier"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gftool.fourier</span></code></a>.
As a major part of the package, these functions are gu-functions.
This is indicated in the docstrings via the shapes <em class="xref py py-obj">(…, N)</em>. The ellipsis
stands for arbitrary leading dimensions. Let’s consider a simple example with magnetic splitting.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">beta</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># inverse temperature</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h</span> <span class="o">=</span> <span class="mf">0.3</span>  <span class="c1"># magnetic splitting</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">h</span><span class="p">,</span> <span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">h</span><span class="p">])</span>  <span class="c1"># on-site energy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">iws</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">matsubara_frequencies</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1024</span><span class="p">),</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">)</span>
</pre></div>
</div>
<p>We can calculate the Fourier transform using broadcasting,
no need for any loops.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gf_iw</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">bethe_gf_z</span><span class="p">(</span><span class="n">iws</span> <span class="o">+</span> <span class="n">eps</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">half_bandwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gf_iw</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(2, 1024)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gf_tau</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">fourier</span><span class="o">.</span><span class="n">iw2tau</span><span class="p">(</span><span class="n">gf_iw</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">)</span>
</pre></div>
</div>
<p>The Fourier transform generates the imaginary time Green’s function on the interval
<span class="math notranslate nohighlight">\(τ ∈ [0^+, β^-]\)</span></p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">gf_tau</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span> <span class="n">gf_tau</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\sigma=\uparrow$&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tau</span><span class="p">,</span> <span class="n">gf_tau</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\sigma=\downarrow$&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\tau$&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//tutorial-6.png">png</a>, <a class="reference external" href=".//tutorial-6.pdf">pdf</a>)</p>
<div class="figure align-default">
<img alt="_images/tutorial-6.png" class="plot-directive" src="_images/tutorial-6.png" />
</div>
<p>We see the asymmetry due to the magnetic field. Let’s check the back transformation.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gf_ft</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">fourier</span><span class="o">.</span><span class="n">tau2iw</span><span class="p">(</span><span class="n">gf_tau</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">gf_ft</span><span class="p">,</span> <span class="n">gf_iw</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">2e-6</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Up to a certain threshold the transforms agree, they are not exact inverse
transformations here. Accuracy can be improved e.g. by providing (or fitting)
high-frequency moments.</p>
</div>
<div class="section" id="single-site-approximation-of-disorder">
<h2>Single site approximation of disorder<a class="headerlink" href="#single-site-approximation-of-disorder" title="Permalink to this headline">¶</a></h2>
<p>We also offer the single site approximation for disordered Hamiltonians,
namely <a class="reference internal" href="generated/gftool.cpa.html#module-gftool.cpa" title="gftool.cpa"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cpa</span></code></a> and it extension to off-diagonal disorder <a class="reference internal" href="generated/gftool.beb.html#module-gftool.beb" title="gftool.beb"><code class="xref py py-obj docutils literal notranslate"><span class="pre">beb</span></code></a>.
These methods treat substitutional disorder.
A multi-component system is considered, where each lattice site is randomly
occupied by one of the components.
The concentration of the components is known.</p>
<div class="section" id="coherent-potential-approximation-cpa">
<h3>Coherent potential approximation (CPA)<a class="headerlink" href="#coherent-potential-approximation-cpa" title="Permalink to this headline">¶</a></h3>
<p>We first consider the <a class="reference internal" href="generated/gftool.cpa.html#module-gftool.cpa" title="gftool.cpa"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cpa</span></code></a>, where only the on-site energies depend on the component.
As example we consider a system of three components.
We choose the on-site energies and concentrations (which should add to <em class="xref py py-obj">1</em>),
as lattice we consider a Bethe lattice with half-bandwidth <em class="xref py py-obj">1</em>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_onsite</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">concentration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g0</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">gt</span><span class="o">.</span><span class="n">bethe_gf_z</span><span class="p">,</span> <span class="n">half_bandwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>The average local Green’s function and the component Green’s functions
(conditional average for local site fixed to a specific component) are calculate
in CPA using an effective medium.
The self-consistent effective medium is obtained via a root search
using <a class="reference internal" href="generated/gftool.cpa.solve_root.html#gftool.cpa.solve_root" title="gftool.cpa.solve_root"><code class="xref py py-obj docutils literal notranslate"><span class="pre">solve_root</span></code></a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ww</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">501</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-6j</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">self_cpa_ww</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">cpa</span><span class="o">.</span><span class="n">solve_root</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="n">e_onsite</span><span class="p">,</span> <span class="n">concentration</span><span class="p">,</span> <span class="n">hilbert_trafo</span><span class="o">=</span><span class="n">g0</span><span class="p">)</span>
</pre></div>
</div>
<p>The average Green’s function is</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gf_coher_ww</span> <span class="o">=</span> <span class="n">g0</span><span class="p">(</span><span class="n">ww</span> <span class="o">-</span> <span class="n">self_cpa_ww</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ww</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">gf_coher_ww</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\omega$&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//tutorial-9.png">png</a>, <a class="reference external" href=".//tutorial-9.pdf">pdf</a>)</p>
<div class="figure align-default">
<img alt="_images/tutorial-9.png" class="plot-directive" src="_images/tutorial-9.png" />
</div>
<p>For frequencies close to the real axis, issues might arise, that the conjugate
solution (advanced instead of retarded) is obtained.
The default <em class="xref py py-obj">restricted=True</em> uses some heuristic to avoid this.
In this example we see at the left band-edge,
that for small imaginary part this can still fail.
In this case, it is enough to just increase the accuracy of the root search.
Additional keyword arguments are passed to <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.root.html#scipy.optimize.root" title="(in SciPy v1.7.1)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">scipy.optimize.root</span></code></a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">self_cpa_ww</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">cpa</span><span class="o">.</span><span class="n">solve_root</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="n">e_onsite</span><span class="p">,</span> <span class="n">concentration</span><span class="p">,</span> <span class="n">hilbert_trafo</span><span class="o">=</span><span class="n">g0</span><span class="p">,</span>
<span class="gp">... </span>                                <span class="n">options</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">fatol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gf_coher_ww</span> <span class="o">=</span> <span class="n">g0</span><span class="p">(</span><span class="n">ww</span> <span class="o">-</span> <span class="n">self_cpa_ww</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ww</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">gf_coher_ww</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\omega$&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//tutorial-10.png">png</a>, <a class="reference external" href=".//tutorial-10.pdf">pdf</a>)</p>
<div class="figure align-default">
<img alt="_images/tutorial-10.png" class="plot-directive" src="_images/tutorial-10.png" />
</div>
<p>Now, everything looks fine.
The component Green’s functions are calculated by <a class="reference internal" href="generated/gftool.cpa.gf_cmpt_z.html#gftool.cpa.gf_cmpt_z" title="gftool.cpa.gf_cmpt_z"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gftool.cpa.gf_cmpt_z</span></code></a>.
The law of total expectation relates the component Green’s functions to the
average Green’s function: <em class="xref py py-obj">np.sum(concentration*gf_cmpt_ww, axis=-1) == gf_coher_ww</em>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gf_cmpt_ww</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">cpa</span><span class="o">.</span><span class="n">gf_cmpt_z</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="n">self_cpa_ww</span><span class="p">,</span> <span class="n">e_onsite</span><span class="p">,</span> <span class="n">hilbert_trafo</span><span class="o">=</span><span class="n">g0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">concentration</span><span class="o">*</span><span class="n">gf_cmpt_ww</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="n">gf_coher_ww</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">cmpt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ww</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">gf_cmpt_ww</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">cmpt</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;cmpt </span><span class="si">{</span><span class="n">cmpt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ww</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">gf_coher_ww</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;avg&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\omega$&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//tutorial-11.png">png</a>, <a class="reference external" href=".//tutorial-11.pdf">pdf</a>)</p>
<div class="figure align-default">
<img alt="_images/tutorial-11.png" class="plot-directive" src="_images/tutorial-11.png" />
</div>
<p>Of course, it can be calculated for any lattice Hilbert transform.
Furthermore, the function is vectorized. Let’s consider a <a class="reference internal" href="generated/gftool.lattice.fcc.html#module-gftool.lattice.fcc" title="gftool.lattice.fcc"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fcc</span></code></a>
lattice, where one component has different on-site energies for up and down spin.
The on-site energies can simply be stacked as 2-dimensional array.
We can also take the previous self-energy as a starting guess <em class="xref py py-obj">self_cpa_z0</em>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">e_onsite</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="o">+</span><span class="mf">0.15</span><span class="p">,</span> <span class="o">+</span><span class="mf">0.4</span><span class="p">],</span>
<span class="gp">... </span>                     <span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.35</span><span class="p">,</span> <span class="o">+</span><span class="mf">0.4</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">concentration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g0</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">gt</span><span class="o">.</span><span class="n">fcc_gf_z</span><span class="p">,</span> <span class="n">half_bandwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">self_cpa_ww</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">cpa</span><span class="o">.</span><span class="n">solve_root</span><span class="p">(</span><span class="n">ww</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">e_onsite</span><span class="p">,</span> <span class="n">concentration</span><span class="p">,</span>
<span class="gp">... </span>                                <span class="n">hilbert_trafo</span><span class="o">=</span><span class="n">g0</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">fatol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">),</span>
<span class="gp">... </span>                                <span class="n">self_cpa_z0</span><span class="o">=</span><span class="n">self_cpa_ww</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gf_cmpt_ww</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">cpa</span><span class="o">.</span><span class="n">gf_cmpt_z</span><span class="p">(</span><span class="n">ww</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">self_cpa_ww</span><span class="p">,</span> <span class="n">e_onsite</span><span class="p">,</span> <span class="n">hilbert_trafo</span><span class="o">=</span><span class="n">g0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">spin</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axes</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">cmpt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">__</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ww</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">gf_cmpt_ww</span><span class="p">[:,</span> <span class="n">spin</span><span class="p">,</span> <span class="n">cmpt</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;cmpt </span><span class="si">{</span><span class="n">cmpt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\omega$&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//tutorial-12.png">png</a>, <a class="reference external" href=".//tutorial-12.pdf">pdf</a>)</p>
<div class="figure align-default">
<img alt="_images/tutorial-12.png" class="plot-directive" src="_images/tutorial-12.png" />
</div>
</div>
<div class="section" id="blackman-esterling-berk-beb">
<h3>Blackman, Esterling, Berk (BEB)<a class="headerlink" href="#blackman-esterling-berk-beb" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="generated/gftool.beb.html#module-gftool.beb" title="gftool.beb"><code class="xref py py-obj docutils literal notranslate"><span class="pre">beb</span></code></a> formalism is an extension of <a class="reference internal" href="generated/gftool.cpa.html#module-gftool.cpa" title="gftool.cpa"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cpa</span></code></a> to off-diagonal disorder.
It allows us to provide different hopping amplitudes.
We have the additional parameter <em class="xref py py-obj">hopping</em> which gives the relative hopping amplitudes.
The <a class="reference internal" href="generated/gftool.cpa.html#module-gftool.cpa" title="gftool.cpa"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cpa</span></code></a> corresponds to <em class="xref py py-obj">hopping=np.ones([N, N])</em>, where <em class="xref py py-obj">N</em> is the number
of components.
The <a class="reference internal" href="generated/gftool.beb.html#module-gftool.beb" title="gftool.beb"><code class="xref py py-obj docutils literal notranslate"><span class="pre">beb</span></code></a> module works very similar to <a class="reference internal" href="generated/gftool.cpa.html#module-gftool.cpa" title="gftool.cpa"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cpa</span></code></a>:
We use <a class="reference internal" href="generated/gftool.beb.solve_root.html#gftool.beb.solve_root" title="gftool.beb.solve_root"><code class="xref py py-obj docutils literal notranslate"><span class="pre">solve_root</span></code></a> to get the effective medium,
in BEB, however, the effective medium is a matrix.
Next the component Green’s function are calculated using <a class="reference internal" href="generated/gftool.beb.gf_loc_z.html#gftool.beb.gf_loc_z" title="gftool.beb.gf_loc_z"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gf_loc_z</span></code></a>.
These are, however, already multiplied by the concentration.
So the average Green’s function is <em class="xref py py-obj">gf_loc_z.sum(axis=-1)</em>.
Let’s compare <a class="reference internal" href="generated/gftool.cpa.html#module-gftool.cpa" title="gftool.cpa"><code class="xref py py-obj docutils literal notranslate"><span class="pre">cpa</span></code></a> and <a class="reference internal" href="generated/gftool.beb.html#module-gftool.beb" title="gftool.beb"><code class="xref py py-obj docutils literal notranslate"><span class="pre">beb</span></code></a>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_onsite</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">concentration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hopping</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g0</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">gt</span><span class="o">.</span><span class="n">bethe_gf_z</span><span class="p">,</span> <span class="n">half_bandwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ww</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">501</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-5j</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">self_cpa_ww</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">cpa</span><span class="o">.</span><span class="n">solve_root</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="n">e_onsite</span><span class="p">,</span> <span class="n">concentration</span><span class="p">,</span> <span class="n">hilbert_trafo</span><span class="o">=</span><span class="n">g0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gf_coher_ww</span> <span class="o">=</span> <span class="n">g0</span><span class="p">(</span><span class="n">ww</span> <span class="o">-</span> <span class="n">self_cpa_ww</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">self_beb_ww</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">beb</span><span class="o">.</span><span class="n">solve_root</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="n">e_onsite</span><span class="p">,</span> <span class="n">concentration</span><span class="o">=</span><span class="n">concentration</span><span class="p">,</span>
<span class="gp">... </span>                                <span class="n">hopping</span><span class="o">=</span><span class="n">hopping</span><span class="p">,</span> <span class="n">hilbert_trafo</span><span class="o">=</span><span class="n">g0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gf_loc_ww</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">beb</span><span class="o">.</span><span class="n">gf_loc_z</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="n">self_beb_ww</span><span class="p">,</span> <span class="n">hopping</span><span class="o">=</span><span class="n">hopping</span><span class="p">,</span> <span class="n">hilbert_trafo</span><span class="o">=</span><span class="n">g0</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ww</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">gf_coher_ww</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;CPA avg&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ww</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">gf_loc_ww</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
<span class="gp">... </span>             <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;BEB avg&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\omega$&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//tutorial-13.png">png</a>, <a class="reference external" href=".//tutorial-13.pdf">pdf</a>)</p>
<div class="figure align-default">
<img alt="_images/tutorial-13.png" class="plot-directive" src="_images/tutorial-13.png" />
</div>
<p>Of course, also the components match:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gf_cmpt_ww</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">cpa</span><span class="o">.</span><span class="n">gf_cmpt_z</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="n">self_cpa_ww</span><span class="p">,</span> <span class="n">e_onsite</span><span class="p">,</span> <span class="n">hilbert_trafo</span><span class="o">=</span><span class="n">g0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c_gf_cmpt_ww</span> <span class="o">=</span> <span class="n">gf_cmpt_ww</span> <span class="o">*</span> <span class="n">concentration</span>  <span class="c1"># to compare with BEB</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">cmpt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ww</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">c_gf_cmpt_ww</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">cmpt</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;CPA </span><span class="si">{</span><span class="n">cmpt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ww</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">gf_loc_ww</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">cmpt</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;BEB </span><span class="si">{</span><span class="n">cmpt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\omega$&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//tutorial-14.png">png</a>, <a class="reference external" href=".//tutorial-14.pdf">pdf</a>)</p>
<div class="figure align-default">
<img alt="_images/tutorial-14.png" class="plot-directive" src="_images/tutorial-14.png" />
</div>
<p>The relevant case is when <em class="xref py py-obj">hopping</em> differs from the CPA case.
Then the components can have different band-widths and also the hopping between
different components can be different.
Let’s say we have two components ‘A’ and ‘B’. The values
<em class="xref py py-obj">hopping=np.array([[1.0, 0.5], [0.5, 1.2]])</em> mean that the hopping amplitude
between ‘B’ sites is <em class="xref py py-obj">1.2</em> times the hopping amplitude between ‘A’ sites;
the hopping amplitude from ‘A’ to ‘B’ is <em class="xref py py-obj">0.5</em> times the hopping amplitude
between ‘A’ sites.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e_onsite</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">concentration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hopping</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
<span class="gp">... </span>                    <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g0</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">gt</span><span class="o">.</span><span class="n">bethe_gf_z</span><span class="p">,</span> <span class="n">half_bandwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ww</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">501</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-5j</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">self_beb_ww</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">beb</span><span class="o">.</span><span class="n">solve_root</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="n">e_onsite</span><span class="p">,</span> <span class="n">concentration</span><span class="o">=</span><span class="n">concentration</span><span class="p">,</span>
<span class="gp">... </span>                                <span class="n">hopping</span><span class="o">=</span><span class="n">hopping</span><span class="p">,</span> <span class="n">hilbert_trafo</span><span class="o">=</span><span class="n">g0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gf_loc_ww</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">beb</span><span class="o">.</span><span class="n">gf_loc_z</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="n">self_beb_ww</span><span class="p">,</span> <span class="n">hopping</span><span class="o">=</span><span class="n">hopping</span><span class="p">,</span> <span class="n">hilbert_trafo</span><span class="o">=</span><span class="n">g0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ww</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">gf_loc_ww</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ww</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">gf_loc_ww</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;B&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ww</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">gf_loc_ww</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
<span class="gp">... </span>             <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;BEB avg&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\omega$&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//tutorial-15.png">png</a>, <a class="reference external" href=".//tutorial-15.pdf">pdf</a>)</p>
<div class="figure align-default">
<img alt="_images/tutorial-15.png" class="plot-directive" src="_images/tutorial-15.png" />
</div>
<p>Additional diagnostic output is logged, you can get information on the convergence
by setting:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">logging</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;gftool.beb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="matrix-green-s-functions-via-diagonalization">
<h2>Matrix Green’s functions via diagonalization<a class="headerlink" href="#matrix-green-s-functions-via-diagonalization" title="Permalink to this headline">¶</a></h2>
<p>The module <a class="reference internal" href="generated/gftool.matrix.html#module-gftool.matrix" title="gftool.matrix"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gftool.matrix</span></code></a> contains some helper functions for matrix diagonalization.
A main use case is to calculate the one-particle Green’s function from the resolvent.
Instead of inverting the matrix for every frequency point,
we can diagonalize the Hamiltonian once:</p>
<div class="math notranslate nohighlight">
\[G(z) = [1z - H]^{-1} = [1z - UλU^†]^{-1} = U [z-λ]^{-1} U^†\]</div>
<p>Let’s consider the simple example of a 2D square lattice with nearest-neighbor hopping.
The Hamiltonian can be easily constructed:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">N</span> <span class="o">=</span> <span class="mi">21</span>   <span class="c1"># system size in one dimension</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">ty</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># hopping amplitude</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hamilton</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">N</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">diag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hamilton</span><span class="p">[</span><span class="n">diag</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="p">:,</span> <span class="n">diag</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">hamilton</span><span class="p">[</span><span class="n">diag</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">:,</span> <span class="n">diag</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="p">:]</span> <span class="o">=</span> <span class="o">-</span><span class="n">tx</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hamilton</span><span class="p">[:,</span> <span class="n">diag</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="p">:,</span> <span class="n">diag</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">hamilton</span><span class="p">[:,</span> <span class="n">diag</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">:,</span> <span class="n">diag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span> <span class="o">=</span> <span class="o">-</span><span class="n">ty</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ham_mat</span> <span class="o">=</span> <span class="n">hamilton</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># turn in into a matrix</span>
</pre></div>
</div>
<p>Let’s diagonalize it using the helper in <a class="reference internal" href="generated/gftool.matrix.html#module-gftool.matrix" title="gftool.matrix"><code class="xref py py-obj docutils literal notranslate"><span class="pre">gftool.matrix</span></code></a> and calculated the Green’s function</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">dec</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">matrix</span><span class="o">.</span><span class="n">decompose_her</span><span class="p">(</span><span class="n">ham_mat</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ww</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">201</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-1j</span>  <span class="c1"># frequency match</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gf_ww</span> <span class="o">=</span> <span class="n">dec</span><span class="o">.</span><span class="n">reconstruct</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">ww</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">-</span> <span class="n">dec</span><span class="o">.</span><span class="n">eig</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gf_ww</span> <span class="o">=</span> <span class="n">gf_ww</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ww</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="n">N</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># reshape for easy access</span>
</pre></div>
</div>
<p>Where we used <a class="reference internal" href="generated/gftool.matrix.Decomposition.reconstruct.html#gftool.matrix.Decomposition.reconstruct" title="gftool.matrix.Decomposition.reconstruct"><code class="xref py py-obj docutils literal notranslate"><span class="pre">reconstruct</span></code></a>
to calculate the matrix product for the given diagonal matrix.
Let’s check the local spectral function of the central lattice site:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ww</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">gf_ww</span><span class="o">.</span><span class="n">imag</span><span class="p">[:,</span> <span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span><span class="o">//</span><span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ww</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">gt</span><span class="o">.</span><span class="n">square_gf_z</span><span class="p">(</span><span class="n">ww</span><span class="p">,</span> <span class="n">half_bandwidth</span><span class="o">=</span><span class="mi">4</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span>
<span class="gp">... </span>              <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">__</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\omega$&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href=".//tutorial-18.png">png</a>, <a class="reference external" href=".//tutorial-18.pdf">pdf</a>)</p>
<div class="figure align-default">
<img alt="_images/tutorial-18.png" class="plot-directive" src="_images/tutorial-18.png" />
</div>
<p>Oftentimes we are only interested in the local Green’s functions and can avoid
a large part of the computation, only calculating the diagonal elements.
This can be done using the <em class="xref py py-obj">kind</em> argument:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gf_diag</span> <span class="o">=</span> <span class="n">dec</span><span class="o">.</span><span class="n">reconstruct</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">ww</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">-</span> <span class="n">dec</span><span class="o">.</span><span class="n">eig</span><span class="p">),</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;diag&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gf_diag</span> <span class="o">=</span> <span class="n">gf_diag</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">ww</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="getting-started.html" class="btn btn-neutral float-left" title="Getting started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="gftool.html" class="btn btn-neutral float-right" title="gftool" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Weh Andreas.
      <span class="lastupdated">Last updated on 2021-13-10.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>